# 2022.11.7 游戏中的数学-矩阵和四元数
## 平移矩阵
```
void Start(){
        //创建平移，旋转和缩放矩阵
        unityMatrix.SetTRS(transform.position, transform.rotation, transform.localScale);
}
void translate(){
        //按照当前位置进行位移
        Vector4 v4 = new Vector4(transform.position.x, transform.position.y, transform.position.z, 1);
        //它的主对角线上的元素为 1，所有其他元素为 0
        selfMatrix = Matrix4x4.identity;
        //移动因子
        selfMatrix.m03 = 3;
        selfMatrix.m13 = 4;
        selfMatrix.m23 = 5;
        //矩阵位移操作
        v4 = selfMatrix * v4;
        transform.position = new Vector3(v4.x, v4.y, v4.z);
        unityMatrix.SetTRS(transform.position, transform.rotation, transform.localScale);
}
```
## 旋转矩阵
```
void rotate(){
        //它的主对角线上的元素为 1，所有其他元素为 0
        selfMatrix = Matrix4x4.identity;
        float cosPositive = Mathf.Cos(angle * Mathf.Deg2Rad);
        float sinPositive = Mathf.Sin(angle * Mathf.Deg2Rad);
        float sinNegative = -sinPositive;
        //对应 X、Y、Z的旋转
        if (axle == Axle.X)
        {
            selfMatrix.m11 = cosPositive;
            selfMatrix.m12 = sinNegative;
            selfMatrix.m21 = sinPositive;
            selfMatrix.m22 = cosPositive;
        }
        else if (axle == Axle.Y)
        {
            selfMatrix.m00 = cosPositive;
            selfMatrix.m02 = sinPositive;
            selfMatrix.m20 = sinNegative;
            selfMatrix.m22 = cosPositive;
        }
        else
        {
            selfMatrix.m00 = cosPositive;
            selfMatrix.m01 = sinNegative;
            selfMatrix.m10 = sinPositive;
            selfMatrix.m11 = cosPositive;
        }
        // 求出旋转的四元数
        float qw = Mathf.Sqrt(1f + selfMatrix.m00 + selfMatrix.m11 + selfMatrix.m22)/2;
        float w = 4 * qw;
        float qx = (selfMatrix.m21 - selfMatrix.m12)/w;
        float qy = (selfMatrix.m02 - selfMatrix.m20)/w;
        float qz = (selfMatrix.m10 - selfMatrix.m01)/w;
        transform.rotation = new Quaternion(qx, qy, qz, qw);
        unityMatrix.SetTRS(transform.position, transform.rotation, transform.localScale);
}
```
## 缩放矩阵
```
void scale(){
        //设置当前对象大小
        Vector4 v4 = new Vector4(transform.localScale.x, transform.localScale.y, transform.localScale.z, 1);
        //它的主对角线上的元素为 1，所有其他元素为 0
        selfMatrix = Matrix4x4.identity;
        //缩放因子
        selfMatrix.m00 = 1;
        selfMatrix.m11 = 2;
        selfMatrix.m22 = 3;
        //矩阵缩放操作
        v4 = selfMatrix * v4;
        transform.localScale = new Vector3(v4.x, v4.y, v4.z);
}
```
## 四元数的几何意义，解决了什么问题

几何意义:由三个虚数单位i、j、k,以X=a+bi+cj+dk的形式说明空间点所在位置，作为用于描述空间的坐标表示方式

使用四元数可以解决万向节死锁（Gimbal Lock）问题仅需存储4个浮点数，相比矩阵更加轻量，四元数在进行求逆、串联等操作，相比矩阵更加高效
## 万向节死锁怎么模拟，出现的现象是什么

将一个Cube的X轴旋转90度，这时候再旋转cube的y轴和Z轴会发现两个轴的旋转方向重合了，这种情况就叫做万向锁